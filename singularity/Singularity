Bootstrap: localimage
From: /nrs/funke/singularity/funkey/gunpylrobi:v1.3.img

%help
This container contains linajea lineage tracking software.

%labels

Maintainer Jan Funke
Name linajea
Version v1.4


%setup
mkdir -p ${SINGULARITY_ROOTFS}/src/linajea

%files
../linajea /src/linajea/linajea
../requirements.txt /src/linajea/requirements.txt
../setup.py /src/linajea/setup.py

%labels
maintainer funkej@janelia.hhmi.org

%post

PATH="/miniconda/bin:$PATH"

# install gunpowder

GUNPOWDER_ROOT=/src/gunpowder
GUNPOWDER_REPOSITORY=https://github.com/funkey/gunpowder.git
GUNPOWDER_REVISION=e6ee429ab7b3c784aaafc041d11dacfbc3a9f8ed

mkdir -p ${GUNPOWDER_ROOT}
cd ${GUNPOWDER_ROOT}
git clone ${GUNPOWDER_REPOSITORY} . && \
git checkout ${GUNPOWDER_REVISION}
pip install -r requirements.txt
PYTHONPATH=${GUNPOWDER_ROOT}:$PYTHONPATH

# install linajea dependencies

DAISY_ROOT=/src/daisy
DAISY_REPOSITORY=https://github.com/funkey/daisy
DAISY_REVISION=41130e58582ae05d01d26261786de0cbafaa6482

mkdir -p ${DAISY_ROOT}
cd ${DAISY_ROOT}
git clone ${DAISY_REPOSITORY} . && \
git checkout ${DAISY_REVISION}
pip install -r requirements.txt
pip install .

COMATCH_ROOT=/src/comatch
COMATCH_REPOSITORY=https://github.com/funkey/comatch
#slightly older master
COMATCH_REVISION=3aebd8606da7d0f48f262e546a9ae614ceca7af7
# master
#COMATCH_REVISION=193ca3072ae27666c54939f4bb0a4911404f33d7
# quadmatch
#COMATCH_REVISION=fa7c9e3ea9f9b5ddc2fb74654378d696b7a14b35

mkdir -p ${COMATCH_ROOT}
cd ${COMATCH_ROOT}
git clone ${COMATCH_REPOSITORY} . && \
git checkout ${COMATCH_REVISION}
python setup.py install

# install linajea

cd /src/linajea
pip install -r requirements.txt
python setup.py install

pip install plotly

%environment
export DAISY_ROOT=/src/daisy
export PYTHONPATH=${DAISY_ROOT}:$PYTHONPATH
export GUNPOWDER_ROOT=/src/gunpowder
export PYTHONPATH=${GUNPOWDER_ROOT}:$PYTHONPATH

%runscript
exec /bin/bash "$@"
